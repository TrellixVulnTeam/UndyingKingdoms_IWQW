{% extends "gameplay/layout.html" %}
{% block content2 %}

{% set user = current_user %}
{% set county = current_user.county %}
{% set kingdom = county.kingdom %}

<br><br><br><br>
<h2>Total Land: {{ county.land }}</h2>
<h2>Available Land: {{ county.get_available_land() }}</h2>
<h2>Daily Production:
    {{ county.get_production()|int }} <img class="resource_icons" src="/static/images/prod_icon.jpg">
    ({{ county.get_available_workers() }} available workers)
</h2>
<h2>Current Resources:
    {{ county.gold }} <img class="resource_icons" src="/static/images/gold_icon.jpg">
    {{ county.wood }} <img class="resource_icons" src="/static/images/wood_icon.jpg">
    {{ county.iron }} <img class="resource_icons" src="/static/images/iron_icon.jpg">
</h2>
<br>
<form method="POST" accept-charset="UTF-8" role="form">
    {{ form.csrf_token }}
    <table id="infrastructure_table">
        <tr>
            <th style="width:150px;">Name</th>
            <th>Currently Have</th>
            <th>To Be Built</th>
            <th>Under Construction</th>
            <th style="width:125px;">Cost</th>
            <th style="width:150px;">Workers Employed</th>
            <th>Description</th>
        </tr>
        {% for building in county.buildings.values() %}
        <tr>
            <td>{{ building.class_name.title() }}</td>
            <td>{{ building.amount }}</td>
            <td>
                <input id="{{ building.base_name }}_slider"
                       type="range" value="0" min="0" max="{{ county.get_available_land() }}" step="1" />
                <input id="{{ building.base_name }}_display" name="{{ building.base_name }}" value="0" />
            </td>
            <td>{{ building.pending }}</td>
            <td>
                {% if building.production %}{{ building.production }}<img class="resource_icons" src="/static/images/prod_icon.jpg">{% endif %}
                {% if building.gold %}{{ building.gold }}<img class="resource_icons" src="/static/images/gold_icon.jpg">{% endif %}
                {% if building.wood %}{{ building.wood }}<img class="resource_icons" src="/static/images/wood_icon.jpg">{% endif %}
            </td>
            <td>{{ building.labour_maintenance }} each ({{ building.labour_maintenance * building.total }} total)</td>
            <td>{{ building.description }}</td>
        </tr>
        {% endfor %}
    </table>
    <br><button id="submit" type="submit" disabled>Build</button><br>
    <p>
    Any excess <img class="resource_icons" src="/static/images/prod_icon.jpg"> will be converted into gold at the end of each day.
    Each day your kingdom will randomly produce pending buildings until you can not produce any more.
    </p>
</form>

<script type="text/javascript">
{% for building in county.buildings.values() %}
    var {{ building.base_name }}_slider = document.getElementById('{{ building.base_name }}_slider'),
    {{ building.base_name }}_display = document.getElementById('{{ building.base_name }}_display');
    {{ building.base_name }}_slider.onchange = function() {
        {{ building.base_name }}_display.value = this.value;
        if (this.value > 0) {
            button.disabled = false;
        }
    }
{% endfor %}
button = document.getElementById('submit');
</script>

{% endblock %}

